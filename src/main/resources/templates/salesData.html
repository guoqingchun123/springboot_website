<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
	<div th:replace="common :: header"></div>
	<link th:href="@{/layui/css/maps.css}" rel="stylesheet" type="text/css">
	<link th:href="@{/themes/iconfont/iconfont.css}" rel="stylesheet" type="text/css">
	<link th:href="@{/themes/css/sales.css}" rel="stylesheet" type="text/css">
</head>
<body class="layui-layout-body layout-body">
<div class="layui-layout layui-layout-admin">
	<div class="layui-header layui-bg-blue" style="position: fixed;width: 100%;">
		<div class="layui-col-md3" style="padding-left: 15px;padding-top: 15px">
			<img th:src="@{/themes/images/logo.png}">
		</div>
		<div class="layui-col-md9" style="padding-right: 15px;">
			<div style="float: right">
				<input type='text' autocomplete="off" placeholder="请输入小区名称和小区地址检索"
					   class="layui-input layui-input-search" name="auto-regions" id="auto-regions">
				<a href="javascript:;"><i class="layui-icon layui-icon-search"></i></a>
			</div>
		</div>
	</div>
	<div id="layui-body" data-anim="layui-anim-upbit" style="width: 75%;min-width: 1000px;margin:0 auto;padding-top: 65px;">
		<div style="width: 100%;height:60px;background-color: white;padding-top: 15px;line-height: 60px;">
			<div class="layui-col-md3" style="padding-left: 15px">
				<h1 th:text="${region.regionName}"></h1>
			</div>
			<div class="layui-col-md9">
				<span class="layui-breadcrumb" lay-separator="|" style="font-size: 30px">
				  <a href="javascript:;" data-value="index">首页</a>
				  <a href="javascript:;" data-value="salesData">销售情况</a>
				  <a href="javascript:;" data-value="houseHold">户型图</a>
				  <a href="javascript:;" data-value="regionImage">项目相册</a>
				</span>
				<!--
                <span class="sale-summary">
                    <span th:each="houseHold:${region.listHouseHold}" th:if="${houseHold.sellNum > 0}">
                        <span th:text="${houseHold.houseShow}"></span>：<span th:text="${houseHold.sellPrice}"></span>
                    </span>
                </span>
                -->
			</div>
		</div>
		<div style="width: 100%;background-color: white;margin-top: 10px;height:auto;overflow:hidden;">
			<div class="layui-col-md6" style="min-height: 1px;">
				<div class="layui-carousel" id="carousel">
					<div carousel-item="">
						<div id="regionSalesData"></div>
						<div style="padding-left: 2px;text-align: center" th:each="str:${region?.regionLogos}">
							<img th:src="${str}" style="height: 400px"/>
						</div>
					</div>
				</div>
			</div>
			<div id="viewImageDiv" class="layui-col-md6" style="padding-left: 3px">
				<div style="position: relative;height: auto;display:inline-block">
                    <div th:if="${cellNo == null}">
                        <img th:src="${region?.viewPath}" class="view-url" style="height:400px">
                        <div th:each="regionBld, iterStat:${region?.listRegionBlds}" th:if="${region.listRegionBlds}">
							<span th:class="${region.viewPath != null ? 'bldSpan' : 'bldDiv'}" th:classappend="${bldNo == null ? iterStat.index == 0 : bldNo == regionBld.bldNo} ? 'selectedBld'"
                              th:data-project-id="${regionBld.projectId}" th:data-bld-no="${regionBld.bldNo}" th:style="${regionBld.location}" th:text="${regionBld.bldName}"></span>
                        </div>
                    </div>
                    <div th:if="${cellNo != null}">
                        <img th:src="${region.bldView.viewPath}" class="view-url" style="height:400px">
						<a class="return-to" href="javascript:;">返回</a>
                        <div th:each="cell, iterStat:${region.bldView.cells}" th:if="${cell.location != null}">
                            <span th:class="cellSpan" th:classappend="${cellNo == cell.CellNo} ? 'selectedCell'"
                                  th:data-project-id="${cell.projectId}" th:data-bld-no="${cell.bldNo}" th:data-cell-no="${cell.cellNo}" th:style="${cell.location}" th:text="${cell.cellName}"></span>
                        </div>
                    </div>
				</div>
			</div>
		</div>
		<div class="sale-summary" th:if="region?.priceShows">
			<span>项目备案情况：</span>
			<span th:each="price:${region.priceShows}">
				<span th:text="${price.houseShow}"></span>
				（<span th:each="housePrice, iterStat:${price.housePrices}">
					<span th:if="${iterStat.index > 0}">，</span>
					<span th:text="${housePrice.houseHold}"></span>：<span th:text="${housePrice.price}"></span>元/平方米</span>）
			</span>
		</div>
		<div id="salesDataDiv" style="width: 100%;background-color: white;height:auto;">
			<div id="houseCardContainer" class="layui-tab-content">
				<div class="layui-elem-quote">
					<label style="color: #959595;font-size: large;font-weight: bold"
						   th:text="${region.bldView.bldSales.cellName != null ? region.bldView.bldSales.cellName : region.bldView.bldSales.bldName}"></label>
					<label style="color: #959595;font-size: large;font-weight: bold">销售情况：</label>
					总套数：<label style="color: #333333;font-size: large;font-weight: bold" th:text="${region.bldView.bldSales.totalNum}"></label>
					已售套数：<label style="color: red;font-size: large;font-weight: bold" th:text="${region.bldView.bldSales.sellNum}"></label>
					未售套数：<label style="color: #00dd02;font-size: large;font-weight: bold" th:text="${region.bldView.bldSales.noSaledNum}"></label>
					[抵押：<label style="color: #ddb400;font-size: large;font-weight: bold" th:text="${region.bldView.bldSales.mortgageNum}"></label>
					查封：<label style="color: #dd6600;font-size: large;font-weight: bold" th:text="${region.bldView.bldSales.closeNum}"></label>
					冻结：<label style="color: #dd8800;font-size: large;font-weight: bold" th:text="${region.bldView.bldSales.frozenNum}"></label>]
					非卖套数：<label style="color: #b9d8dd;font-size: large;font-weight: bold" th:text="${region.bldView.bldSales.noSaleNum}"></label>
				</div>
				<div class="legends">
					<div th:each="legend:${region.bldView?.legends}" class="legend"><i class="iconfont icon-home-fill" th:style="'color: #' + ${legend.color}"></i><span th:text="${legend.name}"></span></div>
				</div>
				<div th:if="${region.bldView.showCell}" class="cells">
					<div th:each="cell:${region.bldView?.cells}" th:text="${cell.cellName}"
						 th:style="'width: ' + (${cell.showHouseNum} * 154 + 24) + 'px'" class="cell-name"></div>
				</div>
				<ul class="layui-timeline">
					<li th:each="floor:${region.bldView?.floors}" class="layui-timeline-item floor">
						<i class="layui-icon layui-timeline-axis" th:text="${floor.floorName}"></i>
						<div class="layui-timeline-content layui-text">
							<div th:each="cell:${floor?.cells}" class="cell"
								 th:styleappend="${region.bldView.showCell && floor.showCell} ? 'width: ' + (${cell.showHouseNum} * 154 + 4) + 'px' : ''">
								<div th:each="house:${cell?.houses}" class="room-list">
									<div class="bg-gdcd" th:style="'background: #' + ${house.presellStateCode}"><span th:text="${house.showName}"></span><span class="sell-state" th:text="${house.presellStateName}"></span></div>
									<div class="m-bott">建筑面积：<span th:text="${house.constructArea}">㎡</span></div>
									<div class="room-content">
										<div class="content-top">
											<h3 th:text="${house.showName}"></h3>
										</div>
										<div class="content-box">
											<div class="box-title"><span th:text="${house.houseUse}"></span><span th:text="${house.presellStateName}"></span></div>
                                            <p>建筑面积：<span th:text="${house.constructArea}"></span>㎡</p>
											<p>套内面积：<span th:text="${house.ownArea}"></span>㎡</p>
											<p>户型：<span th:text="${house.houseHold}"></span></p>
											<p th:if="${house.presellPrice != null && house.presellPrice > 0 && house.salesFlag == '是'}">备案价格：<span th:text="${house.presellPrice}"></span>元/㎡</p>
										</div>
									</div>
								</div>
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>
<div th:replace="common :: footer"></div>
<script th:src="@{/layui/layui.js}"></script>
<script th:src="@{/layui/echarts/echarts.js}"></script>
<script th:src="@{/layui/echarts/macarons.js}"></script>
<script th:inline="javascript">
	var ctxPath = /*[[@{/}]]*/'';
	layui.config({
		base: ctxPath + 'layui/autocomplete/'
	}).extend({ //设定模块别名
		autocomplete: 'autocomplete'
	});
	layui.use(['carousel', 'element', 'layer', 'autocomplete', 'laytpl'], function () {
		var $ = layui.jquery;
		var autocomplete = layui.autocomplete;
		var laytpl = layui.laytpl;

		// $("#layui-body").height(window.innerHeight - 60);
		// auto 快速定位，过滤小区
		autocomplete.render({
			elem: $('#auto-regions')[0],
			url: ctxPath + 'auto-regions',
			template_val: '{{d.regionName}}',
			template_txt: '{{d.regionName}} <span class=\'layui-badge layui-bg-gray\'>{{d.address}}</span>',
			onselect: function (resp) {
				// 跳转到选择的项目详情页面
				window.location.href = ctxPath + 'content/' + resp.regionId;
			}
		});

		var carousel = layui.carousel;

		carousel.render({
			elem: '#carousel'
			, width: '100%' //设置容器宽度
			, height: '400px'
			, arrow: 'always' //始终显示箭头
		});

		var layid = location.hash.replace(/^#tab=/, '');
		var element = layui.element;
		element.tabChange('tab', layid);

		element.on('tab(tab)', function (elem) {
			location.hash = 'tab=' + $(this).attr('value');
		});

		$(".layui-breadcrumb a").on("click", function () {
			var viewType = $(this).attr("data-value");
			if (viewType === 'index') {
				window.location.replace(ctxPath);
			} else if (viewType === 'salesData') {
				window.location.replace(ctxPath + 'content/' + [[${region.regionId}]]);
			} else {
				window.location.replace(ctxPath + 'content/' + [[${region.regionId}]] + "?viewType=" + viewType);
			}
		});

		$(".bldSpan,.bldDiv").on("click", function () {
			// var bldId = $(this).attr("value");
			var projectId = $(this).attr('data-project-id');
			var bldNo = $(this).attr('data-bld-no');

			layer.load(2);
			window.location.replace(ctxPath + 'content/' + [[${region.regionId}]] + '/' + projectId + '/' + encodeURIComponent(bldNo));


			// $(".bldSpan,.bldDiv").removeClass("selectedBld");
			// $(this).addClass("selectedBld");
		});
		$(".cellSpan").on("click", function () {
			var projectId = $(this).attr('data-project-id');
			var bldNo = $(this).attr('data-bld-no');
			var cellNo = $(this).attr('data-cell-no');

            layer.load(2);
			window.location.replace(ctxPath + 'content/' + [[${region.regionId}]] + '/' + projectId + '/' + encodeURIComponent(bldNo) + '/' + encodeURIComponent(cellNo));
		});

		$('.return-to').on('click', function () {
            layer.load(2);
			window.location.replace(ctxPath + 'content/' + [[${region.regionId}]]);
		});

		var option = {
			title: {
				text: '项目销售情况',
				x: 'left'
			},
			tooltip: {
				trigger: 'item',
				formatter: "{b} : {c} ({d}%)"
			},
			series: [
				{
					name: '销售情况',
					type: 'pie',
					radius: '85%',
					data: [[${region.salesData}]],
					label: {
						normal: {
							formatter: function(v) {
								return Math.round(v.percent) + '%' + '' + v.name
							},
							textStyle: {
								fontWeight: 300,
								fontSize: 16    //文字的字体大小
							}
						}
					}
				}
			]
		};

		var regionSalesDataCharts = echarts.init(document.getElementById('regionSalesData'), 'macarons');

		regionSalesDataCharts.setOption(option);

		$(window).resize(function () {
			regionSalesDataCharts.resize();
		});

		$('img').error(function () {
			$(this).attr('src', ctxPath + "themes/images/nothing.png");
		});
	});
</script>
</body>
</html>